\subsection{Illustrated by an example}
\label{secIllu}

We illustrate the method introduced in this chapter by a simple example here. 
Given a query expression $ax(a+b)$ and document expression $ax + (b+a)by$, here we show how we search the relevant document using this query and how the relevance score between them is calculated by mark-and-cross algorithm.

The query expression and document expression are represented by operation trees $T_q$ and $T_d$ in figure~\ref{expGraph}, 
instead of only denoting the operation symbols at the internal nodes and the variable (also can be a constant) symbols at the leaf nodes, we use the notation $^i_l S$ to denote a node with symbol $S$ labeled by $l$ (i.e. $\ell(S)=l$) with vertex number $i$. 
The three different possible labels here are $v,\ t$ and $a$, standing for unified name ``variable", ``times" and ``add" respectively.
To be concise and descriptive, we will interchangeably use either $^i_l S$ notation or $q_i$ ($p_i$) to represent the leaf-root path in a query (document) operation tree where the leaf vertex $i$ resides.

Firstly, the generated path sets for $T_q$ and $T_d$ are:
$$
\begin{aligned}
g(T_q) &= \{ 1\cdot6,\; 2\cdot6,\; 3\cdot5\cdot6,\; 4\cdot5\cdot6\} \\
g(T_d) &= \{ 5\cdot8\cdot10,\; 6\cdot8\cdot10,\; 3\cdot7\cdot8\cdot10,\; 4\cdot7\cdot8\cdot10,\; 1\cdot9\cdot10,\; 2\cdot9\cdot10\}
\end{aligned}
$$
And the labeled path sets for each of the two are:
$$
\begin{aligned}
\ell\left(g(T_q)\right) &= \{ v\cdot t,\; v\cdot a\cdot t \} \\
\ell\left(g(T_d)\right) &= \{ v\cdot t\cdot a,\; v\cdot a\cdot t \cdot a \}
\end{aligned}
$$
Because $\ell\left(g(T_q)\right) \cdot a = \ell\left(g(T_d)\right)$, or equivalently 
$$
\ell(g(T_q)) \cdot \hat{a} \subseteq \ell(g(T_d))
$$
where $\hat{a} = a$, 
we know $T_d$ is searchable by $T_q$, so we will find a path $\hat{a}$ to append after the labeled path set $\ell\left(g(T_d)\right)$ in index $\Pi$ and obtain $T_d$ to be considered as structurally relevant to $T_q$.
We can also infer the matching-depth $d$ here is $|\hat{a}| = 1$. 

\begin{figure}
\begin{minipage}[b]{2.65in}
\begin{center}
\resizebox{2.4in}{!}{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \begin{tikzpicture}[anchor=mid,>=latex',line join=bevel,]
\begin{tikzpicture}[>=latex',line join=bevel,]
  \pgfsetlinewidth{1bp}
\Huge%
\begin{scope}
  \pgfsetstrokecolor{black}
  \definecolor{strokecol}{rgb}{1.0,1.0,1.0};
  \pgfsetstrokecolor{strokecol}
  \definecolor{fillcol}{rgb}{1.0,1.0,1.0};
  \pgfsetfillcolor{fillcol}
  \filldraw (0bp,0bp) -- (0bp,180bp) -- (234bp,180bp) -- (234bp,0bp) -- cycle;
\end{scope}
\begin{scope}
  \pgfsetstrokecolor{black}
  \definecolor{strokecol}{rgb}{1.0,1.0,1.0};
  \pgfsetstrokecolor{strokecol}
  \definecolor{fillcol}{rgb}{1.0,1.0,1.0};
  \pgfsetfillcolor{fillcol}
  \filldraw (0bp,0bp) -- (0bp,180bp) -- (234bp,180bp) -- (234bp,0bp) -- cycle;
\end{scope}
  \pgfsetcolor{black}
  % Edge: ad5 -- b4
  \draw [] (179.35bp,72.765bp) .. controls (185.17bp,61.456bp) and (192.89bp,46.437bp)  .. (198.7bp,35.147bp);
  % Edge: ti6 -- a1
  \draw [] (84.43bp,146.83bp) .. controls (72.02bp,134.77bp) and (54.269bp,117.51bp)  .. (41.796bp,105.38bp);
  % Edge: ad5 -- a3
  \draw [] (162.65bp,72.765bp) .. controls (156.83bp,61.456bp) and (149.11bp,46.437bp)  .. (143.3bp,35.147bp);
  % Edge: ti6 -- ad5
  \draw [] (113.57bp,146.83bp) .. controls (125.98bp,134.77bp) and (143.73bp,117.51bp)  .. (156.2bp,105.38bp);
  % Edge: ti6 -- x2
  \draw [] (99bp,143.7bp) .. controls (99bp,132.85bp) and (99bp,118.92bp)  .. (99bp,108.1bp);
  % Node: b4
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (207bp,18bp) ellipse (27bp and 18bp);
  \draw (207bp,18bp) node {$^4_v b$};
\end{scope}
  % Node: ad5
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (171bp,90bp) ellipse (27bp and 18bp);
  \draw (171bp,90bp) node {$^5_a +$};
\end{scope}
  % Node: ti6
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (99bp,162bp) ellipse (27bp and 18bp);
  \draw (99bp,162bp) node {$^6_t \times$};
\end{scope}
  % Node: a1
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (27bp,90bp) ellipse (27bp and 18bp);
  \draw (27bp,90bp) node {$^1_v a$};
\end{scope}
  % Node: a3
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (135bp,18bp) ellipse (27bp and 18bp);
  \draw (135bp,18bp) node {$^3_v a$};
\end{scope}
  % Node: x2
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (99bp,90bp) ellipse (27bp and 18bp);
  \draw (99bp,90bp) node {$^2_v x$};
\end{scope}
%
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
} 
\\[5mm]
query expression $ax(a+b)$
\end{center}
\end{minipage}
\hspace*{.18in}
\begin{minipage}[b]{2.65in}
\begin{center}
\resizebox{3.3in}{!}{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[>=latex',line join=bevel,]
  \pgfsetlinewidth{1bp}
\Huge%
\begin{scope}
  \pgfsetstrokecolor{black}
  \definecolor{strokecol}{rgb}{1.0,1.0,1.0};
  \pgfsetstrokecolor{strokecol}
  \definecolor{fillcol}{rgb}{1.0,1.0,1.0};
  \pgfsetfillcolor{fillcol}
  \filldraw (0bp,0bp) -- (0bp,252bp) -- (342bp,252bp) -- (342bp,0bp) -- cycle;
\end{scope}
\begin{scope}
  \pgfsetstrokecolor{black}
  \definecolor{strokecol}{rgb}{1.0,1.0,1.0};
  \pgfsetstrokecolor{strokecol}
  \definecolor{fillcol}{rgb}{1.0,1.0,1.0};
  \pgfsetfillcolor{fillcol}
  \filldraw (0bp,0bp) -- (0bp,252bp) -- (342bp,252bp) -- (342bp,0bp) -- cycle;
\end{scope}
  \pgfsetcolor{black}
  % Edge: ad0 -- ti8
  \draw [] (192.43bp,218.83bp) .. controls (180.02bp,206.77bp) and (162.27bp,189.51bp)  .. (149.8bp,177.38bp);
  % Edge: ti9 -- a1
  \draw [] (243bp,143.7bp) .. controls (243bp,132.85bp) and (243bp,118.92bp)  .. (243bp,108.1bp);
  % Edge: ad7 -- b4
  \draw [] (179.35bp,72.765bp) .. controls (185.17bp,61.456bp) and (192.89bp,46.437bp)  .. (198.7bp,35.147bp);
  % Edge: ti8 -- b5
  \draw [] (116.19bp,148.81bp) .. controls (96.365bp,135.96bp) and (65.338bp,115.85bp)  .. (45.597bp,103.05bp);
  % Edge: ti9 -- x2
  \draw [] (257.57bp,146.83bp) .. controls (269.98bp,134.77bp) and (287.73bp,117.51bp)  .. (300.2bp,105.38bp);
  % Edge: ad7 -- a3
  \draw [] (162.65bp,72.765bp) .. controls (156.83bp,61.456bp) and (149.11bp,46.437bp)  .. (143.3bp,35.147bp);
  % Edge: ti8 -- y6
  \draw [] (126.65bp,144.76bp) .. controls (120.83bp,133.46bp) and (113.11bp,118.44bp)  .. (107.3bp,107.15bp);
  % Edge: ti8 -- ad7
  \draw [] (143.35bp,144.76bp) .. controls (149.17bp,133.46bp) and (156.89bp,118.44bp)  .. (162.7bp,107.15bp);
  % Edge: ad0 -- ti9
  \draw [] (215.35bp,216.76bp) .. controls (221.17bp,205.46bp) and (228.89bp,190.44bp)  .. (234.7bp,179.15bp);
  % Node: b4
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (207bp,18bp) ellipse (27bp and 18bp);
  \draw (207bp,18bp) node {$^4_v b$};
\end{scope}
  % Node: ti8
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (135bp,162bp) ellipse (27bp and 18bp);
  \draw (135bp,162bp) node {$^8_t \times$};
\end{scope}
  % Node: ti9
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (243bp,162bp) ellipse (27bp and 18bp);
  \draw (243bp,162bp) node {$^9_t \times$};
\end{scope}
  % Node: ad0
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (207bp,234bp) ellipse (27bp and 18bp);
  \draw (207bp,234bp) node {$^{10}_a +$};
\end{scope}
  % Node: ad7
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (171bp,90bp) ellipse (27bp and 18bp);
  \draw (171bp,90bp) node {$^7_a +$};
\end{scope}
  % Node: a1
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (243bp,90bp) ellipse (27bp and 18bp);
  \draw (243bp,90bp) node {$^1_v a$};
\end{scope}
  % Node: b5
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (27bp,90bp) ellipse (27bp and 18bp);
  \draw (27bp,90bp) node {$^5_v b$};
\end{scope}
  % Node: a3
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (135bp,18bp) ellipse (27bp and 18bp);
  \draw (135bp,18bp) node {$^3_v a$};
\end{scope}
  % Node: x2
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (315bp,90bp) ellipse (27bp and 18bp);
  \draw (315bp,90bp) node {$^2_v x$};
\end{scope}
  % Node: y6
\begin{scope}
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (99bp,90bp) ellipse (27bp and 18bp);
  \draw (99bp,90bp) node {$^6_v y$};
\end{scope}
%
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
} 
\\[5mm]
document expression $ax + (b+a)by$
\end{center}
\end{minipage}
\caption{Example query/document expression representation}\label{expGraph}
\end{figure}

Secondly, by the implications from observation~\#1 of section~\ref{observationlabel}, we get the candidate set for each of the path in $T_q$:
$$
\begin{aligned}
C_{q_1} &= \{ p_5,\; p_6 \} \\
C_{q_2} &= \{ p_5,\; p_6 \} \\
C_{q_3} &= \{ p_3,\; p_4 \} \\
C_{q_4} &= \{ p_3,\; p_4 \} 
\end{aligned}
$$

In addition, get the list $L$ containing all the query paths in $T_q$ sorted by symbol and its occurrence in all path symbols, 
$$
L = ^1_v a,\ ^3_v a,\ ^4_v b,\ ^2_vx.
$$

Lastly, we can calculate the symbolic similarity degree between the two expressions by going through each query path in $L$ and apply mark-and-cross algorithm. 
Let factor function $f(d) = \dfrac{1}{1 + d}$ (so that matching-depth factor is $0.5$), and $\alpha = 0.9$.

Our system Cowpie \footnote{demo page: \url{infolab.ece.udel.edu:8912/cowpie/}}

\let\thefootnote\relax\footnote{Contact author: clock126@126.com or
\url{http://www.eecis.udel.edu/~zhongwei}}

MathML vs LaTeX
