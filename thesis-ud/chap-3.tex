\chapter{Implementation and Evaluation}

Our system Cowpie \footnote{demo page: \url{infolab.ece.udel.edu:8912/cowpie/}}

Because we are parsing \LaTeX\ directly, while most researches evaluate using MathML/XML format collection, 
and original \LaTeX\ information is not always preserved in the dataset converted from \textit{LaTeXML}, 
we have tried to convert MathML/XML dataset back to \LaTeX\ using \textit{pandoc}, but failed to convert all the document correctly. 
Nevertheless, we have crawled \textit{Mathjax} content (in \LaTeX) from nearly all the posts from Math Stack Exchange website before March 2015 (61MB raw data in text files with one \LaTeX\ formula per line) and choose to use our own dataset to evaluate the data.
Our test query set consists queries mostly from NTCIR-10 Math Formula Search~\cite{ntcirtopic} and \cite{symbolpairs15}, some of them we are not able to find similar formula in our own dataset, are excluded from our test query set.
Table~\ref{TestQ} shows our complete test queries used in our evaluation. 

\begin{table}
\begin{center}
\renewcommand{\arraystretch}{2}
\begin{tabular}{|c|c||c|c|}\hline
ID & formula & ID & formula \\ \thickhline
1 & 
$\int_0^\infty dx \int_{x}^\infty F(x,y)dy  =\int_0^\infty dy \int_{0}^y F(x,y)dx$ &
2 & 
$X(i\omega)$ \\\hline

3 & 
$x^n + y^n=z^n$ &
4 & 
$\int^{\infty}_{-\infty} e^{-x^2} dx$ \\\hline

5 & 
$\frac{f(x+h)-f(x)}{h}$ &
6 & 
$\frac {\sin x} x$ \\\hline

7 & 
$ax^2 + bx +c$ &
8 & 
$\frac {e^x + y}{z}$ \\\hline

7 & 
$O(n \log n)$ &
8 & 
$H^n(X) = Z^n (X) / B^n(X)$ \\\hline

9 & 
$A_n = \frac 1 \pi \int_{-\pi}^\pi F(x) \cos(nx) dx$ &
10 & 
$\lim_{x \to \infty} (1 + \dfrac 1x)^x$ \\\hline

11 & 
$f(x) = f(0) + f'(0)x + \frac{f''(0)}{2!} x^2 + \ldots$ &
12 & 
$f(a) = \frac 1 {2 \pi i} \oint_r \frac{f(z)}{z-a} \;\mathrm{d}z$ \\\hline

13 & 
$x^2 + 2xy + y^2 = |x|^2 + 2|x||y| + |y| ^2$ &
14 & 
$\int_a^b f(x) \;\mathrm{d}x = F(b) - F(a)$ \\\hline

15 & 
$\frac {n!}{r_1! \cdot r_2! \cdots r_k!}$ &
16 & 
$-b \pm \sqrt{b^2 - 4ac}$ \\\hline

17 & 
$1+\tan^2 \theta = \sec^2 \theta$ &
18 & 
$\bar{u} = (x,y,z)$ \\\hline

\end{tabular}
\renewcommand{\arraystretch}{1}
\end{center}
\caption{Test query set}\label{TestQ}
\end{table}

\begin{table}
\begin{center}
\begin{tabular}{|c"c|c|c|c|c|c|}
\hline
\multirow{2}{*}{Query ID} & \multicolumn{5}{c|}{Relevance Score} & \multirow{2}{*}{Total judged} \\
\cline{2-6}
& 0 & 1 & 2 & 3 & 4 &   \\ \thickhline
1  &  15 &  2 &  2 &  0 &  1 &  20\\
2  &  19 &  0 &  0 &  0 &  0 &  19\\
3  &  15 &  4 &  1 &  0 &  0 &  20\\
4  &  0 &  0 &  0 &  6 &  14 &  20\\
5  &  0 &  0 &  0 &  8 &  12 &  20\\
6  &  0 &  2 &  5 &  2 &  10 &  19\\
7  &  1 &  4 &  3 &  3 &  9 &  20\\
8  &  5 &  1 &  1 &  1 &  0 &  8\\
9  &  0 &  0 &  4 &  11 &  5 &  20\\
10  &  0 &  0 &  1 &  16 &  3 &  20\\
11  &  0 &  0 &  0 &  1 &  6 &  7\\
12  &  0 &  0 &  4 &  13 &  3 &  20\\
13  &  14 &  3 &  1 &  1 &  1 &  20\\
14  &  0 &  2 &  5 &  8 &  5 &  20\\
15  &  0 &  0 &  0 &  15 &  5 &  20\\
16  &  8 &  6 &  2 &  2 &  2 &  20\\
17  &  0 &  0 &  5 &  13 &  2 &  20\\
18  &  19 &  1 &  0 &  0 &  0 &  20\\ \hline
\end{tabular}
\end{center}

\caption{Query statistics for matching structurally only}\label{query_stat_for_struct}
\end{table}

\begin{table}
\begin{center}
\begin{tabular}{|c"c|c|c|c|c|c|}
\hline
\multirow{2}{*}{Query ID} & \multicolumn{5}{c|}{Relevance Score} & \multirow{2}{*}{Total judged} \\
\cline{2-6}
& 0 & 1 & 2 & 3 & 4 &   \\ \thickhline
1  &  13 &  2 &  2 &  1 &  1 &  19\\
2  &  15 &  1 &  0 &  3 &  1 &  20\\
3  &  0 &  0 &  0 &  0 &  20 &  20\\
4  &  0 &  0 &  0 &  1 &  19 &  20\\
5  &  0 &  0 &  0 &  0 &  20 &  20\\
6  &  1 &  0 &  0 &  0 &  19 &  20\\
7  &  0 &  0 &  0 &  0 &  20 &  20\\
8  &  4 &  0 &  1 &  2 &  0 &  7\\
9  &  0 &  2 &  5 &  8 &  5 &  20\\
10  &  0 &  0 &  0 &  9 &  11 &  20\\
11  &  0 &  0 &  0 &  2 &  5 &  7\\
12  &  0 &  0 &  12 &  3 &  5 &  20\\
13  &  15 &  1 &  2 &  1 &  1 &  20\\
14  &  0 &  0 &  0 &  0 &  20 &  20\\
15  &  0 &  0 &  0 &  13 &  6 &  19\\
16  &  0 &  0 &  2 &  0 &  18 &  20\\
17  &  0 &  0 &  0 &  0 &  20 &  20\\
18  &  0 &  0 &  2 &  7 &  11 &  20\\ \hline
\end{tabular}
\end{center}

\caption{Query statistics for matching structurally with symbolic scoring}\label{query_stat_for_both}
\end{table}
